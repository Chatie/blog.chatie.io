---
title: Running locally
---

<!-- MDX import -->
import Tabs     from '@theme/Tabs'
import TabItem  from '@theme/TabItem'

import ShortestChatbots from '../polyglot/transclusions/shortest-chatbots.mdx'

<!-- Pushes a curious reader through the first few minutes of use. -->

For running Ding Dong Bot, you can setup your own server for running locally. Just follow the steps below:

1. Getting Started
1. Clone the [Ding Dong Bot](https://github.com/wechaty/wechaty-getting-started) repository
1. Install dependencies
1. Run the bot

## Try out the bot

[![Edit wechaty-ding-dong-bot](https://codesandbox.io/static/img/play-codesandbox.svg)](https://codesandbox.io/s/github/wechaty/wechaty-getting-started/tree/master/examples/third-parties/codesandbox?hidenavigation=1&module=%2Fding-dong-bot.ts&theme=dark)

You can try out Ding Dong Bot using this interactive CodeSandbox.

Just scan the generated QR code with **WeChat** app and you are ready to go.

<iframe
  class="codesandbox"
  src="https://codesandbox.io/embed/github/wechaty/wechaty-getting-started/tree/master/examples/third-parties/codesandbox?fontsize=12&hidenavigation=1&module=%2Fding-dong-bot.ts&theme=dark"
  sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"
></iframe>

## Requirements

1. [Node.js](https://nodejs.dev/) v12+
1. [Wechaty Puppet Service TOKEN](https://wechaty.js.org/docs/puppet-services/) (if you want to use RPA protocols other than Web)

## Usage

<ShortestChatbots />

## Getting Started

In this tutorial you will learn to use Ding Dong bot which replies with a `dong` message when it receives a `ding` message.

Before getting started make sure you have `Node` installed on your system. If you do not have `Node.js` installed (or have a version below 12),
then you need to install the latest version of `Node.js` by following the links below:

:::note Node.js installation docs

* [Windows](https://nodejs.org/en/download/package-manager/#windows)
* [Linux\(Debian/Ubuntu\)](https://nodejs.org/en/download/package-manager/#debian-and-ubuntu-based-linux-distributions)
* [macOS](https://nodejs.org/en/download/package-manager/#macos)

> Installation guide for `Node.js` in other platforms can be found [here](https://nodejs.org/en/download/package-manager/).

:::

You can head over to [Building the bot](#building-the-bot) section to learn how to build the bot on your own.

If you just want to try out the bot on your local system, follow the steps below.

### 1. Install make

You will need `make` for running the **Makefile**, use the command below to install:

<Tabs
  groupId="operating-systems"
  defaultValue="linux"
  values={[
    { label: 'Linux',   value: 'linux', },
    { label: 'macOS',   value: 'mac', },
    { label: 'Windows', value: 'windows', },
  ]
}>

<TabItem value="linux">

```sh
sudo apt install build-essential
```

</TabItem>
<TabItem value="mac">

```sh
brew install make
```

</TabItem>
<TabItem value="windows">

```sh
choco install make
```

</TabItem>
</Tabs>

### 2. Clone repository

You can clone the [Ding Dong Bot](https://github.com/wechaty/wechaty-getting-started) repository by following the below command, and navigate to the directory:

```bash
git clone https://github.com/wechaty/wechaty-getting-started
cd wechaty-getting-started
```

### 3. Install dependencies

For installing the required `npm` dependencies run the following:

```bash
# npm install
make install
```

### 4. Run the bot

First, you have to `export/set` the environment variables, and then you can run the bot:

<Tabs
  groupId="operating-systems"
  defaultValue="linux"
  values={[
    { label: 'Linux',   value: 'linux', },
    { label: 'macOS',   value: 'mac', },
    { label: 'Windows', value: 'windows', },
  ]
}>

<TabItem value="linux">

```bash
export WECHATY_LOG=verbose
export WECHATY_PUPPET=wechaty-puppet-wechat
make bot
# the above is equals to the below command:
# npm start
#   or, npx ts-node examples/ding-dong-bot.ts
```

</TabItem>
<TabItem value="mac">

```bash
export WECHATY_LOG=verbose
export WECHATY_PUPPET=wechaty-puppet-wechat
make bot
# the above is equals to the below command:
# npm start
#   or, npx ts-node examples/ding-dong-bot.ts
```

</TabItem>
<TabItem value="windows">

```bash
set WECHATY_LOG=verbose
set WECHATY_PUPPET=wechaty-puppet-wechat
make bot
# the above is equals to the below command:
# npm start
#   or, npx ts-node examples/ding-dong-bot.ts
```

</TabItem>
</Tabs>

You can install `npx` by using this command:

```sh
npm install -g npx
```

> There are various **Wechaty puppets** available, you can know more about them [here](https://github.com/wechaty/wechaty-getting-started#working-with-different-puppets).

This will generate a QR code. Scan it using Wechat or WhatsApp depending upon the puppet used. 

You are ready to play with the bot.

## Building the bot

Let's get started with building the Ding Dong bot using Wechaty.

### 1. Initialise project

Create a new folder called `ding-dong-bot` and move into that directory.

```bash
mkdir ding-dong-bot
cd ding-dong-bot
```

Use the following command to initialise and npm project.

```bash
npm init -y
```

This will generate a `package.json` file containing these:

```json
{
  "name": "ding-dong-bot",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC"
}
```

### 2. Add dependencies

For building the ding dong bot you will require these dependencies:

* [wechaty](https://www.npmjs.com/package/wechaty): Official Wechaty package
* [dotenv](https://www.npmjs.com/package/dotenv): For loading environment variables from .env file to process.env
* [qrcode-terminal](https://www.npmjs.com/package/qrcode-terminal): Displays the QR code

```json
"dependencies": {
  "dotenv": "^8.2.0",
  "qrcode-terminal": "^0.12.0",
  "wechaty": "^0.60.3",
}
```
You will also need to add dependencies for using any [Wechaty Puppet](https://wechaty.js.org/docs/puppet-providers/) 
which helps to integrate Wechaty with various **instant messaging (IM) systems** (such as WeChat, Whatsapp, and Gitter):

```json
"devDependencies": {
  "wechaty-puppet-mock": "^0.28.2",
  "wechaty-puppet-wechat": "^0.28",
  "wechaty-puppet-wechat4u": "^0.18",
  "wechaty-puppet-whatsapp": "0.2.3"
}
```

> Only add that puppet which you need for using the bot

After adding few more required dependencies, `package.json` file will look like this:

```json
{
  "name": "ding-dong-bot",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
    "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "dotenv": "^8.2.0",
    "qrcode-terminal": "^0.12.0",
    "wechaty": "^0.60.3",
  },
  "devDependencies": {
    "@chatie/eslint-config": "^0.12.3",
    "@chatie/git-scripts": "^0.6.2",
    "@chatie/tsconfig": "^0.14.1",
    "check-node-version": "^4.1.0",
    "connect": "^3.7.0",
    "cross-env": "^7.0.3",
    "is-pr": "^2.0.0",
    "marked": "^2.0.0",
    "nodemon": "^2.0.7",
    "wechaty-puppet-mock": "^0.28.2",
    "wechaty-puppet-wechat": "^0.28",
    "wechaty-puppet-wechat4u": "^0.18",
    "wechaty-puppet-whatsapp": "0.2.3"
  }
}
```

### 3. Install dependencies

Before proceeding further, you should install the dependencies that we just specified in the `package.json` file. Run the following command from the root directory:

```sh
npm install
```

This will generate a `node_modules` directory containing all the installed dependencies, and a `package-lock.json` file.

### 4. Configure TypeScript

Create a new file called `tsconfig.json` inside the root folder of the npm project directory, add the following:

```json
{
  "extends": "@chatie/tsconfig",
  "compilerOptions": {
    "outDir": "dist",
  },
  "exclude": [
    "node_modules/",
    "dist/",
    "tests/fixtures/",
  ],
  "include": [
    "app/**/*.ts",
    "bin/*.ts",
    "bot/**/*.ts",
    "examples/**/*.ts",
    "scripts/**/*.ts",
    "src/**/*.ts",
    "tests/**/*.spec.ts",
  ],
}
```

Now, you are ready to write main code for bot

### 5. Writing code for bot

Create a new folder called `src`, and add a file `ding-dong-bot.ts`. We will be writing the code here.

Let's import the required packages in the `ding-dong-bot.ts` file:

```ts
import {
  Contact,
  Message,
  ScanStatus,
  Wechaty,
  log,
}from 'wechaty'
  
import { generate } from 'qrcode-terminal'

require('dotenv').config()
```

Now we will write some functions which will be required for handling different events returned by bot.

**onScan**

This function will be required for generating QR code for puppet specified and Displays it on console.

```ts
function onScan (qrcode: string, status: ScanStatus) {
  if (status === ScanStatus.Waiting || status === ScanStatus.Timeout) {
    generate(qrcode, { small: true })  // show qrcode on console

    const qrcodeImageUrl = [
      'https://wechaty.js.org/qrcode/',
      encodeURIComponent(qrcode),
    ].join('')

    log.info('StarterBot', 'onScan: %s(%s) - %s', ScanStatus[status], status, qrcodeImageUrl)
  } else {
    log.info('StarterBot', 'onScan: %s(%s)', ScanStatus[status], status)
  }
}
```
**1.**  If `status` is **Waiting** or **Timeout** then function `onScan` will generate qrcode

**2.**  `qrcodeImageUrl` is used for reading the generated `qrcode`. `encodeURIComponent(qrcode)` encodes a URI (string that refers to a resource ie. qrcode) by replacing each instance of certain characters by UTF-8 encoding of characters. 

**3.**  After reading the `qrcode` it return `ScanStatus`.

**onLogin**

This function will print message when a user logs into the bot.

```ts
function onLogin (user: Contact) {
  log.info('StarterBot', '%s login', user)
}
```

**onLogout**

This will print message when a user logs out.

```ts
function onLogout (user: Contact) {
  log.info('StarterBot', '%s logout', user)
}
```

**onMessage**

This will print a log message. If the message is `ding` then it will print `dong`.

```ts
async function onMessage (msg: Message) {
  log.info('StarterBot', msg.toString())

  if (msg.text() === 'ding') {
    await msg.say('dong')
  }
}
```

Now initialising the bot by providing a name.

```ts
const bot = new Wechaty({
  name: 'ding-dong-bot',
})
```

Assigning proper functions to call when an event is triggered.

```ts
bot.on('scan',    onScan)
bot.on('login',   onLogin)
bot.on('logout',  onLogout)
bot.on('message', onMessage)
```

Finally for starting the bot

```ts
bot.start()
  .then(() => log.info('StarterBot', 'Starter Bot Started.'))
  .catch(e => log.error('StarterBot', e))
```

### 6. Defining scripts

You have to define the script for running the bot. Add the following to your `package.json` file:

```json
"scripts": {
  "lint": "eslint \"src/*.ts\"",
  "start": "ts-node src/ding-dong-bot.ts",
  "start:js": "node src/ding-dong-bot.js",
  "start:wechat:web": "cross-env WECHATY_LOG=verbose WECHATY_PUPPET=wechaty-puppet-wechat npm start",
  "start:wechat:padlocal": "cross-env WECHATY_LOG=verbose WECHATY_PUPPET=wechaty-puppet-padlocal npm start",
  "start:puppet:service": "cross-env WECHATY_LOG=verbose WECHATY_PUPPET=wechaty-puppet-service npm start",
  "start:whatsapp:web": "cross-env WECHATY_LOG=verbose  WECHATY_PUPPET=wechaty-puppet-whatsapp npm start",
  "test": "npm run lint && npm run test:version && npm run test:smoke",
  "test:smoke": "ts-node tests/smoke-testing.ts",
  "test:version": "check-node-version --node \">= 12\""
}
```

## Running the bot

In order to run the bot, first you have to **export/set** an environment variable with the type of puppet to use and then run the bot:


<Tabs
  groupId="operating-systems"
  defaultValue="linux"
  values={[
    { label: 'Linux',   value: 'linux', },
    { label: 'macOS',   value: 'mac', },
    { label: 'Windows', value: 'windows', },
  ]
}>

<TabItem value="linux">

```bash
export WECHATY_LOG=verbose
export WECHATY_PUPPET=wechaty-puppet-wechat
make bot
# the above is equals to the below command:
# npm start
#   or, npx ts-node examples/ding-dong-bot.ts
```

</TabItem>
<TabItem value="mac">

```bash
export WECHATY_LOG=verbose
export WECHATY_PUPPET=wechaty-puppet-wechat
make bot
# the above is equals to the below command:
# npm start
#   or, npx ts-node examples/ding-dong-bot.ts
```

</TabItem>
<TabItem value="windows">

```bash
set WECHATY_LOG=verbose
set WECHATY_PUPPET=wechaty-puppet-wechat
make bot
# the above is equals to the below command:
# npm start
#   or, npx ts-node examples/ding-dong-bot.ts
```

</TabItem>
</Tabs>

This will start bot and generate QR code like this:

![hard-way](../../static/img/docs/getting-started/running-locally/hard-way.png)

Scan it using your **WeChat/WhatsApp** as per the puppet you have selected, and you are ready to play with the bot!

## Bot demonstration

![bot-demo](../../static/img/docs/getting-started/running-locally/bot-demo.png)

## Conclusion 

You have learnt to make a ding dong bot.

## References

**[wechaty-getting-started](https://github.com/wechaty/wechaty-getting-started)**

