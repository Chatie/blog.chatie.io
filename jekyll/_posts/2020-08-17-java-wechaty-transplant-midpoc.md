---
title: Wechaty Java 移植组件开发
author: cunkoulaocai
categories: project
tags:
  - java
  - soc
  - soc2020
  - ecosystem
image: /assets/2020/java-wechaty-transplant-midpoc/java-wechaty-transplant-midpoc.webp
---

## 暑期 2020

“开源软件供应链点亮计划-暑期 2020”（以下简称 暑期 2020）是由中科院软件所与 openEuler 社区共同举办的一项面向高校学生的暑期活动。
旨在鼓励在校学生积极参与开源软件的开发维护，促进国内优秀开源软件社区的蓬勃发展。
根据项目的难易程度和完成情况，参与者还可获取“开源软件供应链点亮计划-暑期 2020”活动奖金和奖杯。
官网：<https://isrc.iscas.ac.cn/summer2020> 官方新闻：<http://www.iscas.ac.cn/xshd2016/xshy2016/202004/t20200426_5563484.html>
本项目 [Wechaty Java 组件移植] 系 暑期 2020 支持的开源项目。

## 暑期 2020 [Wechaty Java 组件移植] POC 成果展示

## [Wechaty Java 组件移植]信息

- 导师：刁政欣

- 学生：陈炀

- 项目名称：Wechaty

- 方案描述：用 java 或者 kotlin 将 typescript 版的 wechaty 移植到 java/kotlin 平台上

- 时间规划：

  memory-card 存储

  - 7.1 - 7.19
  - 该模块移植是项目的基本要求,为了能够满足机器人重新登陆不需要扫码,保存机器人自身信息等功能,需要用到这个组件,这个组件将存储的功能和存储数据的结构相分离,以便能够简单的更换存储方式,支持阿里云 oss,华为云 obs,亚马逊 s3,json 存储等,同时提供了易用的 api 来使用
  - 基本功能

  state-switch 状态机

  - 7.20 - 7.26
  - state-switch 是用于管理异步操作的监视器/保护器,在原本的 ts 版本中可以通过 Promise 的特性来比较轻松的实现,在 kotlin 则需要其他的 api 来实现,思路 比较清晰,但是要找到合适的实现手段有点麻烦
  - 基本功能

  (选做) 其他 api 移植与测试

  - 7.27 - 8.7
  - java-wechaty 中还有许多 api 没有实现,api 的风格也是仿照 js 来实现的,后续需要将这些 api 逐步实现,并且修改其 api 风格,以更适合 java 和 kotlin 等语言
  - 扩展功能

  (选做) 理解底层原理,添加一些新功能

  - 8.8-8.15
  - 此部分为选作内容,wechaty 还有一些关于 miniprogram,红包等功能还未实现,需要能够理解底层,以便进行后续的扩展,逐步增强 wechaty 的功能
  - 扩展功能

## 项目进度

- 已完成工作：

1. 完成 memory-card 和 states-witch 组件的开发，由于其中一部分涉及到 aws，而 aws 需要 visa 等银行卡才能注册，所以这个部分虽然编写了但是没有测试，但是我添加了一个阿里云的接口方便使用。
2. 完成大部分 typescript 版 api 的移植，目前应该是几乎所有的 ts 版本的 api 都已经移植完毕，当然会有一些 bug,并且在 api 的易用性上还没有达到很好的要求。
3. 进行了一些现有 api 的测试，修复一些小 bug，当然还有一些 bug 还没有修复,期待下一阶段开发.

- 遇到的问题及解决方案：

> 快速学习 kotlin 并了解程序架构和逻辑

虽然说是`java`移植开发，但根据导师的建议和整个项目的整体性，我还是选择用 kotlin 开发，但是我之前还没有写过 kotlin，我必须立马花些时间来学习 kotlin，对于高级特性和有可能会遇到的错误只能遇到了再说了。整个程序逻辑架构还是比较清晰的，虽然还是花了点时间来明白工作流程

> java 和 kotlin 中的异步支持

由于有了 async 和 await 以及 Promise，js 对于异步的支持是更好的，因此对于移植过程中的异步的操作，我们是需要仔细考虑的。当然由于用了 kotlin，后续还可以尝试使用协程来进行编写。

> 协程的考虑

在编写 state-switch 的时候，对于 ts 版的理解花费了点时间，主要还是因为 promise 的理解不到位，当理解了工作原理之后，由于 kotlin 中没有类似的 api 可以解决，因此花了点时间探索，最后在导师的建议之下，以及考虑到是用 kotlin 编写的，可以使用协程，暂时决定采用协程加上阻塞队列来实现，目前看来好像实现了效果。

这个协程还是蛮有意思的，kotlin 的协程感觉有些地方还是很难理解的。

心得体会：在整个项目的后半段由于我这边出现了一点问题，导致拖慢了进度，好在是任务的难度没有很大，导师人也很好。最终不论有没有通过考核，这份参与开源项目的经历，都是值得回味的。

> 移植这东西我感觉蛮有意思的

不同的编程语言，有不同的思维方式的碰撞，花几天的时间快速学一门语言并进行实践也是蛮有意思的一件事情，整个移植虽然最主要的考虑到是功能的移植，但是还是要注意 api 的易用性，ts 和 java 的 api 的风格还是有不少区别的。

> github 的开发流程简单体验

用 github 的参与到开源社区中是一次很有意思的体验，虽然之前有在同一个小组进行 github 上的合作，但是流程还是不一样，还有 github 的 CI/CD 流程我也是第一次体会到，对于开源社区的会议讨论我也是第一次体会到。

> 高质量的单元测试

说实话我还是不太懂得怎么写出高质量的单元测试，后续要继续学习。

- 后续工作安排：

从目前的进度来看，还是有一些东西需要完成的

1. 写一个 springboot starter 方便 springboot 项目进行集成，里面应该会有存储的配置以及 token 的配置
2. 将 memory-card 组件进行拆分（不拆分感觉也行）
3. 继续完善 api 测试，我试了一下有些 api 达不到想要的效果，比如 tags 接口就有问题
4. 开发新的功能，现有的一些 api 还有一些未完成，还有一些功能没有实现
5. 文档的更新和完善（最近好像是更新过文档了，但是还是有一些东西还没有完善)，好像是没有中文文档

## Demo Day 视频

youtube 地址为：<https://www.youtube.com/watch?v=ipRq3kT32wI>
{% include iframe.html src="https://www.youtube.com/watch?v=ipRq3kT32wI" %}

## 联系我们

- 项目链接：<https://github.com/cunkoulaocai/java-wechaty>
- 联系方式：+86 15806082601 | e: <1184016190@qq.com>
