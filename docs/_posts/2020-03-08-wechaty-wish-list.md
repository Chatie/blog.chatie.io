---
title: "借助Wechaty实现心愿机器人"
author: 江湖夜雨
date: '2020-03-08T21:00:00+0800'
categories: event
tags:
  - meetup
header:
  teaser: /assets/2019/wechaty-ricepo/logo.png
---

> 作者: [江湖夜雨]

## 内容纲要

* 一个新想法：心愿机器人
* 为什么选择Wechaty
* 主要功能设想
* 安装使用过程中的一点心得
* 未来的期望

<!--more-->

## 一个新想法：心愿机器人

微信目前已成为国人必不可少的沟通工具，2019年微信月活用户已经超过了11亿，个人平均使用时长已经超过了80分钟。微信已经不仅仅是一个即时通讯工具，也不只是一个人们交流信息的平台，它已经发展为一个很庞大的生态。我们一直在思考能利用微信做出一个什么东西来，他即有趣，又有一点实用性，解决人们生化中的一些实际问题。

现在人们经常在网上买东西，但是每个人都要自己的兴趣爱好，都有自己的生活圈子，每个人喜欢的、关注的物品都有所不同但又具有一定规律性。人们可以把因为某件事情，某个爱好所需要购买的商品收集在一起，然后分享给朋友，感兴趣的朋友就可以打开这个列表，看到这些商品，也许其中一些商品就会真的转化为订单！

我们把这个称作心愿机器人，用户可以把商品的链接通过微信分享给它，它会自动帮助用户整理成商品清单，这个清单可以分享给其他好友或者发布在朋友圈中。

## 为什么选择Wechaty

要想实现上面的想法，必须找到一款开源的产品，它能够调用微信的接口，能够方便的收发信息，管理好友、群组等。

我们在网上搜索了一些相关领域的产品，感觉鱼龙混杂，有些功能太简单，有的调用起来不太方便，有的文档太少，有的好几年都没有维护。

正好在一次展会上，我们接触到了Wechaty这款产品，也有幸听到了@Huan的演讲，感觉wechaty的功能正是我们所需要的，而且Wechaty的架构清晰，开放的接口简单易懂，文档也很丰富，能够很方便的实现机器人的相关功能。我们加入了Wechaty的开发者群，里边可以探讨技术问题，而且该产品一直在迭代更新，这更坚定了我们使用这款产品的信心！

## 主要功能设想

* 邀请好友描或识别心愿机器人的二维码，发送指定的信息，机器人自动审核通过。
![INVITE](/assets/2020/2020-03-wishlist-invite.jpg)

* 机器人自动回复，并温馨提示如何使用
![PROMPT](/assets/2020/2020-03-wishlist-prompt.jpg)

* 机器人分析用户分享给它的链接，如果是支持网站的商品链接则自动持久化，并生成心愿单并把地址回复给用户，用户点击该地址，可以看到属于自己的心愿单。
![WISHLIST](/assets/2020/2020-03-wishlist-list.jpg)

* ●	分享给好友后，好友可以点击链接购买，也可以定制自己的心愿单

## 安装使用过程中的一点心得

目前的Wechaty是使用nodejs来实现的，nodejs使用js和ts作为开发语言，我对js比较熟悉，ts和nodejs还是头一次接触。虽然他们之间是一脉相承的，但是还是有很多新的概念、新的语法、新的规则需要我来消化吸收，在这过程中也有了一些体会和心得。

* 安装nodejs

Wechaty官方建议nodejs10.0以上的版本，而在CentOS中使用yum默认安装时nodejs是6.17的版本，这点需要注意。

* 安装Wechaty模块

使用npm install wechaty时，可能会遇到长时间无响应或者网络超时的错误，这个可能是部分网站被屏蔽的原因，可以使用国内淘宝的镜像来安装。

* 切换连接微信的协议

使用Wechaty连接微信的时候，有多种协议可以选择，最常用的是2种：Puppeteer和Padplus（padpro已经不再维护）。Puppeteer是基于web的协议，但是2017年以后注册的微信用户已经不能使用，Padplus是基于ipad的协议，并没有这个限制，但必须申请token后才能使用。
切换2种协议，非常简单，设置好指定的环境变量之后，再运行wechaty就可以了。

Puppeteer:
```bash
export WECHATY_PUPPET=wechaty-puppet-puppeteer
```

Padplus：
```bash
export WECHATY_PUPPET=wechaty-puppet-padplus
export WECHATY_PUPPET_PADPLUS_TOKEN=***your token**
```

## 未来的期望

关于心愿机器人，目前仍在开发中，相信很快会与大家见面。初期的功能很简单，未来我们希望依托Wechaty的强大的支持，来实现更多的功能。比如能支持更多的电商网站的分享链接；机器人的回复看起来更智能，更有趣；用户对自己的心愿单能够分组、添加标签、编辑删除等。

我们会持续努力！

